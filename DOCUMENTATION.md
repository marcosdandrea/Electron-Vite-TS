# üìò Documentaci√≥n Completa del Boilerplate Electron-Vite-TS

## üéØ Descripci√≥n General

Este boilerplate proporciona una arquitectura completa para aplicaciones Electron con React, TypeScript, Vite, Express y Socket.IO. Su caracter√≠stica principal es la **capacidad de ejecutarse en dos modos diferentes**: como una aplicaci√≥n de escritorio tradicional (Electron) o como un servidor headless (sin interfaz gr√°fica).

### Caracter√≠sticas Principales

- ‚ö° **Vite** - Desarrollo ultra r√°pido con HMR (Hot Module Replacement)
- üñ•Ô∏è **Electron** - Aplicaciones de escritorio multiplataforma
- ‚öõÔ∏è **React 18** - UI moderna con TypeScript
- üåê **Express Server** - Servidor HTTP integrado
- üîå **Socket.IO** - Comunicaci√≥n en tiempo real
- üîí **Sistema de Seguridad** - M√∫ltiples capas de protecci√≥n
- üìù **Sistema de Logs** - Registro detallado de eventos
- üé≠ **Modo Dual** - Electron o Headless
- üîê **Autenticaci√≥n** - Sistema de tokens integrado

---

## üîß Variables de Entorno (.env)

El archivo `.env` es el coraz√≥n de la configuraci√≥n del boilerplate. Cada bandera controla aspectos espec√≠ficos del comportamiento de la aplicaci√≥n.

### üì± APP - Configuraci√≥n de Aplicaci√≥n

#### `USE_AUTHENTICATION`
```env
USE_AUTHENTICATION=true
```

**Tipo:** Boolean (`true` | `false`)

**Prop√≥sito:** Activa o desactiva el sistema de autenticaci√≥n mediante tokens.

**Funcionamiento:**
- Cuando est√° en `true`:
  - Se genera un token √∫nico al iniciar el servidor
  - Las conexiones de Socket.IO requieren este token para autenticarse
  - El middleware de autenticaci√≥n valida cada conexi√≥n
  - Se registran logs de intentos de conexi√≥n autorizados/denegados
  
- Cuando est√° en `false`:
  - Las conexiones Socket.IO se aceptan sin validaci√≥n
  - No se genera token de autenticaci√≥n
  - **‚ö†Ô∏è Solo recomendado para desarrollo local**

**Uso en c√≥digo:**
```typescript
// El TokenManager genera y valida tokens
const tokenManager = TokenManager.getInstance();
const token = tokenManager.generateToken(APP_TOKENS.AUTH_TOKEN);
```

---

### üîí SECURITY - Configuraci√≥n de Seguridad

#### `LOCALHOST_ONLY`
```env
LOCALHOST_ONLY=true
```

**Tipo:** Boolean (`true` | `false`)

**Prop√≥sito:** Restringe el acceso al servidor para que solo acepte conexiones desde localhost.

**Funcionamiento:**
- Cuando est√° en `true`:
  - El middleware `useOnlyLocalhost` valida cada request HTTP
  - Solo permite conexiones desde:
    - `127.0.0.1`
    - `::1` (localhost IPv6)
    - `::ffff:127.0.0.1`
    - hostname `localhost`
  - Responde con 403 Forbidden a conexiones externas
  - Registra intentos de conexi√≥n rechazados

- Cuando est√° en `false`:
  - Acepta conexiones desde cualquier IP
  - **‚ö†Ô∏è Usar con precauci√≥n en producci√≥n**

**Casos de uso:**
- ‚úÖ Desarrollo local
- ‚úÖ Aplicaciones Electron de escritorio
- ‚ö†Ô∏è Servidores headless en entornos controlados
- ‚ùå Aplicaciones web p√∫blicas (usar configuraci√≥n adicional)

---

#### `USE_CONTEXT_ISOLATION`
```env
USE_CONTEXT_ISOLATION=true
```

**Tipo:** Boolean (`true` | `false`)

**Prop√≥sito:** Implementa aislamiento de contexto, permitiendo solo conexiones desde clientes autorizados (principalmente Electron).

**Funcionamiento:**
- Cuando est√° en `true`:
  - Valida que las requests HTTP provengan de clientes Electron
  - Detecta mediante:
    - User-Agent (busca la palabra "Electron")
    - Header personalizado `x-electron: true`
  - Permite endpoints p√∫blicos definidos en `PUBLIC_ENDPOINTS`
  - Bloquea navegadores web normales (excepto endpoints p√∫blicos)
  - Registra todos los intentos de acceso

- Cuando est√° en `false`:
  - Permite acceso desde cualquier cliente
  - Los navegadores web pueden acceder a todos los endpoints

**Interacci√≥n con autenticaci√≥n:**
```typescript
// Si USE_CONTEXT_ISOLATION=true, se genera un token autom√°ticamente
if (useContextIsolation) {
    const tokenManager = TokenManager.getInstance();
    tokenManager.generateToken(APP_TOKENS.AUTH_TOKEN);
}
```

**Casos de uso:**
- ‚úÖ Proteger APIs internas de la aplicaci√≥n
- ‚úÖ Prevenir acceso directo desde navegadores
- ‚úÖ Aplicaciones que requieren ejecutarse solo en Electron

---

#### `PUBLIC_ENDPOINTS`
```env
PUBLIC_ENDPOINTS=[/public,/api/config]
```

**Tipo:** Array de strings (formato: `[/ruta1,/ruta2]`)

**Prop√≥sito:** Define qu√© rutas son accesibles p√∫blicamente incluso con `USE_CONTEXT_ISOLATION=true`.

**Funcionamiento:**
- Los endpoints listados son accesibles desde cualquier cliente (navegadores incluidos)
- Los endpoints **siempre p√∫blicos** por defecto:
  - `/assets` - Archivos est√°ticos (CSS, JS, im√°genes)
- Soporta rutas exactas y con subdirectorios:
  ```typescript
  // Verifica ruta exacta o que comience con el endpoint
  const isPublicEndpoint = publicEndpoints.some(endpoint => 
    req.path === endpoint || req.path.startsWith(endpoint + '/')
  );
  ```

**Ejemplos:**
```env
# Solo una ruta p√∫blica
PUBLIC_ENDPOINTS=[/public]

# M√∫ltiples rutas p√∫blicas
PUBLIC_ENDPOINTS=[/public,/api/health,/docs]

# Sin rutas p√∫blicas (solo assets)
PUBLIC_ENDPOINTS=[]
```

**Casos de uso:**
- P√°ginas de login p√∫blicas
- Endpoints de health check
- Documentaci√≥n de API
- Recursos compartibles externamente

---

### üöÄ DEVELOPMENT - Configuraci√≥n de Desarrollo

#### `VITE_DEV_PORT`
```env
VITE_DEV_PORT=5123
```

**Tipo:** Number (1024-65535)

**Prop√≥sito:** Define el puerto en el que Vite Dev Server ejecuta la interfaz de usuario durante el desarrollo.

**Funcionamiento:**
- En modo desarrollo (`npm run dev:electron` o `npm run dev:headless`):
  - Vite inicia el servidor de desarrollo en este puerto
  - Soporta Hot Module Replacement (HMR)
  - La aplicaci√≥n Electron o el navegador apuntan a este puerto
  
**‚ö†Ô∏è Nota importante:**
```
"VITE_DEV_PORT requiere modificaciones adicionales en la ui para funcionar"
```
- Requiere configuraci√≥n en `vite.config.ts`:
```typescript
export default defineConfig({
  server: {
    port: 5123,
    strictPort: true,
  }
})
```

**Casos de uso:**
- Evitar conflictos con otros servicios en puerto 5173 (default de Vite)
- Desarrollo con m√∫ltiples proyectos simult√°neos
- Configuraciones de red espec√≠ficas

---

#### `INCREMENT_PATCH_VERSION_ON_BUILD`
```env
INCREMENT_PATCH_VERSION_ON_BUILD=true
```

**Tipo:** Boolean (`true` | `false`)

**Prop√≥sito:** Incrementa autom√°ticamente la versi√≥n patch del `package.json` en cada build de distribuci√≥n.

**Funcionamiento:**
- Cuando est√° en `true`:
  - Script `increment-version.mjs` se ejecuta antes de cada `dist:*`
  - Lee la versi√≥n actual del `package.json`
  - Incrementa el tercer n√∫mero (patch): `1.0.5` ‚Üí `1.0.6`
  - Guarda el nuevo `package.json`
  - Contin√∫a con el build

- Cuando est√° en `false`:
  - La versi√≥n permanece sin cambios
  - √ötil para builds de prueba

**Versionamiento Sem√°ntico:**
```
MAJOR.MINOR.PATCH
  1  .  0  .  5

PATCH (+1 autom√°tico) - Bug fixes, cambios menores
MINOR (manual) - Nuevas features compatibles
MAJOR (manual) - Breaking changes
```

**Logs:**
```bash
[increment-version] Version incremented: 1.0.5 ‚Üí 1.0.6
```

**Casos de uso:**
- ‚úÖ Builds autom√°ticos con versionamiento
- ‚úÖ CI/CD pipelines
- ‚ùå Desarrollo local (dejar en `false`)

---

### üåê SERVER - Configuraci√≥n del Servidor

#### `MAIN_SERVER_PORT`
```env
MAIN_SERVER_PORT=3000
```

**Tipo:** Number (1024-65535)

**Prop√≥sito:** Puerto en el que Express Server y Socket.IO escuchan las conexiones.

**Funcionamiento:**
- Tanto el servidor HTTP como Socket.IO usan este puerto
- Disponible en toda la aplicaci√≥n mediante:
```typescript
import { env } from '@utils/envLoader.js';
const MAIN_SERVER_PORT = env.MAIN_SERVER_PORT;
```

**Arquitectura:**
```
Cliente ‚Üí http://localhost:3000 ‚Üí Express Server
                                   ‚Üì
                                Socket.IO
```

**Endpoints autom√°ticos:**
- `GET /` - P√°gina principal (index.html o mensaje de servidor)
- `GET /api/config` - Configuraci√≥n del servidor:
```json
{
  "serverPort": 3000,
  "isolation": true,
  "mode": "electron" // o "headless"
}
```

**Casos de uso:**
- Cambiar puerto por conflictos con otros servicios
- Configuraci√≥n por entorno (dev/prod)
- M√∫ltiples instancias de la aplicaci√≥n

---

### üìù LOGGING - Configuraci√≥n de Logs

#### `WRITE_LOG_TO_FILE`
```env
WRITE_LOG_TO_FILE=true
```

**Tipo:** Boolean (`true` | `false`)

**Prop√≥sito:** Activa o desactiva la escritura de logs en archivos del sistema.

**Funcionamiento:**
- Cuando est√° en `true`:
  - Crea directorio `logs/` autom√°ticamente
  - Genera un archivo por d√≠a: `DD-MM-YYYY.log`
  - Mantiene los √∫ltimos 50 archivos (configurable)
  - Escribe logs en formato:
    ```
    2025-10-24T10:30:45.123Z [INFO] [server] Server initialized on port 3000
    ```

- Cuando est√° en `false`:
  - Solo muestra logs en consola
  - No guarda archivos

**Gesti√≥n autom√°tica:**
```typescript
// El sistema mantiene m√°ximo 50 archivos
private manageLogFiles(): void {
    while (files.length > WRITE_LOG_MAX_FILE_COUNT) {
        fs.unlinkSync(oldestFile.path); // Elimina el m√°s antiguo
    }
}
```

**Ubicaci√≥n de logs:**
- **Desarrollo:** `./logs/` (ra√≠z del proyecto)
- **Producci√≥n (Electron):** Junto al ejecutable
- **Producci√≥n (Headless):** `./logs/` (donde se ejecute)

**Casos de uso:**
- ‚úÖ Debugging en producci√≥n
- ‚úÖ Auditor√≠a de eventos
- ‚úÖ An√°lisis de errores hist√≥ricos
- ‚ùå Desarrollo activo (puede generar muchos archivos)

---

#### `WRITE_LOG_LEVEL`
```env
WRITE_LOG_LEVEL=info
```

**Tipo:** String (`debug` | `info` | `warn` | `error`)

**Prop√≥sito:** Define el nivel m√≠nimo de logs que se escribir√°n en archivos.

**Jerarqu√≠a de niveles:**
```
debug ‚Üí info ‚Üí warn ‚Üí error
  ‚Üì      ‚Üì      ‚Üì      ‚Üì
 Todo   Normal Avisos Errores
```

**Comportamiento por nivel:**

| Nivel | Escribe | Casos de uso |
|-------|---------|--------------|
| `debug` | debug, info, warn, error | Desarrollo profundo, debugging detallado |
| `info` | info, warn, error | Producci√≥n normal, monitoreo general |
| `warn` | warn, error | Atenci√≥n a warnings importantes |
| `error` | solo error | Solo errores cr√≠ticos |

**Uso en c√≥digo:**
```typescript
const log = new Log('MyService', true);

log.debug('Detalles t√©cnicos'); // Solo si level=debug
log.info('Operaci√≥n normal');   // Si level=debug|info
log.warn('Advertencia');         // Si level=debug|info|warn
log.error('Error cr√≠tico');      // Siempre se escribe
```

**Ejemplo de salida:**
```log
# WRITE_LOG_LEVEL=info
2025-10-24T10:30:45.123Z [INFO] [server] Server initialized on port 3000
2025-10-24T10:30:46.456Z [WARN] [socket] Rejected unauthorized connection
2025-10-24T10:30:47.789Z [ERROR] [database] Connection failed

# WRITE_LOG_LEVEL=error (solo el error se escribe)
2025-10-24T10:30:47.789Z [ERROR] [database] Connection failed
```

**Recomendaciones:**
- **Desarrollo:** `debug` - Ver todo
- **Producci√≥n:** `info` - Balance entre informaci√≥n y performance
- **Producci√≥n cr√≠tica:** `warn` o `error` - Reducir I/O

---

## üé≠ Modos de Distribuci√≥n

El boilerplate soporta dos modos de ejecuci√≥n completamente diferentes, cada uno con su prop√≥sito espec√≠fico.

### üñ•Ô∏è Modo Electron (Aplicaci√≥n de Escritorio)

**Descripci√≥n:** Aplicaci√≥n completa de escritorio con interfaz gr√°fica, servidor Express integrado y Socket.IO.

#### Caracter√≠sticas:
- ‚úÖ Ventana de Electron con UI React
- ‚úÖ Servidor Express interno
- ‚úÖ Socket.IO para comunicaci√≥n
- ‚úÖ Men√∫ de aplicaci√≥n
- ‚úÖ Bandeja del sistema (opcional)
- ‚úÖ Autoactualizaci√≥n (opcional)
- ‚úÖ Acceso completo al sistema (filesystem, etc.)

#### Comandos:

```bash
# Desarrollo con hot reload
npm run dev:electron

# Build de distribuci√≥n
npm run dist:win    # Windows (NSIS + portable)
npm run dist:mac    # macOS (DMG, ARM64)
npm run dist:linux  # Linux (AppImage)
```

#### Proceso de Build:
1. **Incrementa versi√≥n** (si `INCREMENT_PATCH_VERSION_ON_BUILD=true`)
2. **Limpia distribuciones** anteriores
3. **Transpila Electron** (`build:electron` ‚Üí `dist-electron/`)
   - Compila TypeScript con esbuild
   - Bundle de `main.ts` y `preload.ts`
   - Excluye m√≥dulos nativos de Electron
4. **Build UI** (`build:vite` ‚Üí `dist-ui/`)
   - Compila React con Vite
   - Optimiza assets (minify, tree-shaking)
5. **Empaqueta con electron-builder**
   - Crea instaladores nativos
   - Incluye: `dist-electron/`, `dist-ui/`, `.env`
   - Aplica iconos por plataforma
   - Genera archivos en `dist/`

#### Estructura del ejecutable:
```
MiApp.exe (o .app / .AppImage)
‚îú‚îÄ‚îÄ dist-electron/
‚îÇ   ‚îú‚îÄ‚îÄ main.js
‚îÇ   ‚îî‚îÄ‚îÄ preload.js
‚îú‚îÄ‚îÄ dist-ui/
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îî‚îÄ‚îÄ .env
```

#### Flujo de ejecuci√≥n:
```
1. Usuario ejecuta MiApp.exe
2. main.js ‚Üí Inicia Electron
3. ioProcesses() ‚Üí Levanta Express (puerto 3000) y Socket.IO
4. electronProcess() ‚Üí Crea BrowserWindow
5. Ventana carga ‚Üí http://localhost:3000 (dist-ui/index.html)
6. appProcess() ‚Üí L√≥gica de negocio de la aplicaci√≥n
```

#### Configuraci√≥n (electron-builder.json):
```json
{
  "appId": "com.marcosdandrea.boilerplate",
  "productName": "Boilerplate",
  "files": ["dist-electron", "dist-ui", ".env"],
  "asar": true, // Empaquetado en ASAR
  "win": {
    "target": ["nsis", "dir"] // Instalador + portable
  }
}
```

---

### üîß Modo Headless (Servidor Sin UI)

**Descripci√≥n:** Servidor Node.js puro que ejecuta Express y Socket.IO sin interfaz gr√°fica de Electron. Ideal para servicios backend, APIs y servidores.

#### Caracter√≠sticas:
- ‚úÖ Solo servidor Express + Socket.IO
- ‚úÖ Sin dependencias de Electron
- ‚úÖ Menor consumo de recursos
- ‚úÖ Ejecutable Node.js est√°ndar
- ‚úÖ Ideal para servidores remotos
- ‚úÖ Puede servir la UI como SPA
- ‚ùå Sin ventanas ni UI nativa

#### Comandos:

```bash
# Desarrollo headless
npm run dev:headless

# Build headless
npm run build:headless

# Distribuci√≥n completa
npm run dist:headless
```

#### Proceso de Build:
1. **Incrementa versi√≥n**
2. **Limpia distribuci√≥n**
3. **Build UI** (Vite)
4. **Transpila con headless config** (`build-headless.mjs` ‚Üí `dist/headless/`)
   - Define `process.env.HEADLESS="true"`
   - Excluye Electron completamente
   - Minifica c√≥digo (`minify: true`)
   - Tree-shaking agresivo
5. **Copia archivos necesarios**
   - `headless-package.json` ‚Üí `dist/headless/package.json`
   - `dist-ui/` ‚Üí `dist/headless/dist-ui/`
   - `.env` (manual o script)

#### Estructura del build:
```
dist/headless/
‚îú‚îÄ‚îÄ main.js              # Servidor compilado
‚îú‚îÄ‚îÄ package.json         # Dependencias m√≠nimas
‚îú‚îÄ‚îÄ dist-ui/             # UI est√°tica (opcional)
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ assets/
‚îî‚îÄ‚îÄ .env
```

#### Ejecuci√≥n en producci√≥n:
```bash
# 1. Navegar al directorio
cd dist/headless

# 2. Instalar dependencias (solo producci√≥n)
npm install --production

# 3. Iniciar servidor
npm start  # O: node main.js
```

#### headless-package.json:
```json
{
  "name": "boilerplate-headless",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "node main.js"
  },
  "dependencies": {
    "dotenv": "^16.5.0"  // Solo dependencias runtime
  }
}
```

#### Flujo de ejecuci√≥n:
```
1. node main.js
2. Lee .env ‚Üí Carga configuraci√≥n
3. isHeadless = true ‚Üí Salta electronProcess()
4. ioProcesses() ‚Üí Express + Socket.IO
5. Servidor escucha en MAIN_SERVER_PORT
6. Opcional: Sirve dist-ui/ como SPA
```

#### Variables de entorno espec√≠ficas:
```env
# Configuraci√≥n headless
HEADLESS=true
MAIN_SERVER_PORT=3000
LOCALHOST_ONLY=false     # Para acceso remoto
USE_CONTEXT_ISOLATION=false  # No hay Electron
```

---

### üìä Comparaci√≥n Electron vs Headless

| Aspecto | Electron | Headless |
|---------|----------|----------|
| **UI** | Ventana nativa de escritorio | Solo servidor HTTP (opcional SPA) |
| **Tama√±o** | ~150-300 MB | ~5-20 MB |
| **Inicio** | 2-5 segundos | <1 segundo |
| **Memoria** | 150-500 MB | 30-100 MB |
| **Electron APIs** | ‚úÖ Disponibles | ‚ùå No disponibles |
| **Filesystem** | ‚úÖ Acceso completo | ‚úÖ Solo Node.js |
| **Distribuci√≥n** | Instaladores (.exe, .dmg) | Archivo + node_modules |
| **Updates** | electron-builder | Manual o PM2 |
| **Casos de uso** | Apps de escritorio | APIs, servidores, servicios |

---

### üö¶ Detecci√≥n del Modo en C√≥digo

El c√≥digo detecta autom√°ticamente en qu√© modo est√° ejecut√°ndose:

```typescript
// src/app/main.ts
const isHeadless = process.env.HEADLESS === 'true';

if (!isHeadless) {
    // Solo en Electron: crear ventanas
    const {electronProcess} = await import('./src/main/electronProcess.js');
    await electronProcess();
}

// Siempre: iniciar servidor
const {ioProcesses} = await import('./src/main/ioProcesses.js');
await ioProcesses();
```

---

## üèóÔ∏è Arquitectura del Sistema

### üìÇ Estructura de Procesos

La aplicaci√≥n se divide en tres procesos principales:

#### 1Ô∏è‚É£ **ioProcesses** (I/O Processes)
```typescript
// src/app/src/main/ioProcesses.ts
```
**Responsabilidad:** Inicializar servidor Express y Socket.IO

**Secuencia:**
1. Obtener puerto del servidor (`MAIN_SERVER_PORT`)
2. Determinar directorio est√°tico (dev: Vite, prod: dist-ui)
3. Inicializar Express Server
4. Inicializar Socket.IO sobre el HTTP Server
5. Registrar listeners de Socket.IO

**Se ejecuta en:** Ambos modos (Electron y Headless)

---

#### 2Ô∏è‚É£ **electronProcess** (Electron Process)
```typescript
// src/app/src/main/electronProcess.ts
```
**Responsabilidad:** Gestionar el ciclo de vida de Electron

**Secuencia:**
1. Esperar evento `app.ready`
2. Crear ventana principal (`WindowManager`)
3. Cargar URL del servidor (localhost:3000 o Vite dev)
4. Registrar listeners IPC
5. Manejar cierre de ventanas

**Se ejecuta en:** Solo modo Electron (`!isHeadless`)

---

#### 3Ô∏è‚É£ **appProcess** (Application Process)
```typescript
// src/app/src/main/appProcess.ts
```
**Responsabilidad:** L√≥gica de negocio de la aplicaci√≥n

**Contenido:** Actualmente vac√≠o - placeholder para:
- Tareas programadas (cron jobs)
- Procesamiento en background
- Inicializaci√≥n de m√≥dulos de negocio
- Conexi√≥n a bases de datos
- Etc.

**Se ejecuta en:** Ambos modos

---

### üîÑ Flujo de Comunicaci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              React UI (Frontend)                ‚îÇ
‚îÇ  - Componentes React                            ‚îÇ
‚îÇ  - Contexts (IPC, Socket)                       ‚îÇ
‚îÇ  - Hooks personalizados                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ HTTP                      ‚îÇ Socket.IO
          ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Express Server (Backend)              ‚îÇ
‚îÇ  - Middlewares de seguridad                     ‚îÇ
‚îÇ  - API REST endpoints                           ‚îÇ
‚îÇ  - Servidor de archivos est√°ticos               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                           ‚îÇ
          ‚îÇ                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ                      ‚îÇ Socket.IO‚îÇ
          ‚îÇ                      ‚îÇ  Server  ‚îÇ
          ‚îÇ                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Electron Main Process (si !headless)    ‚îÇ
‚îÇ  - Window Manager                               ‚îÇ
‚îÇ  - IPC Handlers                                 ‚îÇ
‚îÇ  - Sistema de archivos                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

### üîê Capas de Seguridad

El boilerplate implementa un sistema de seguridad en capas:

#### Capa 1: Localhost Only
```typescript
// middlewares/localhostOnly.middleware.ts
```
**Prop√≥sito:** Filtro m√°s b√°sico - solo localhost

**Configuraci√≥n:** `LOCALHOST_ONLY=true`

**Validaci√≥n:**
```typescript
const isLocalhost = remoteAddress === '::1' || 
                   remoteAddress === '127.0.0.1' || 
                   remoteAddress === '::ffff:127.0.0.1';
```

**Respuesta:** 403 si no es localhost

---

#### Capa 2: Context Isolation
```typescript
// middlewares/isolation.middleware.ts
```
**Prop√≥sito:** Solo clientes autorizados (Electron)

**Configuraci√≥n:** `USE_CONTEXT_ISOLATION=true`

**Validaci√≥n:**
```typescript
// Detectar Electron
const isElectron = userAgent.includes('Electron') || 
                  customElectronHeader === 'true';

// Permitir endpoints p√∫blicos
const isPublicEndpoint = publicEndpoints.some(endpoint => 
    req.path.startsWith(endpoint)
);

if (!isElectron && !isPublicEndpoint) {
    return res.status(403).json({ error: 'Access denied' });
}
```

---

#### Capa 3: Authentication (Socket.IO)
```typescript
// middlewares/authentication.middleware.ts
```
**Prop√≥sito:** Validar tokens de autenticaci√≥n en WebSocket

**Configuraci√≥n:** `USE_AUTHENTICATION=true`

**Flujo:**
```typescript
// Cliente debe enviar token en handshake
io.use((socket, next) => {
    const token = socket.handshake.auth.token;
    
    if (!USE_AUTHENTICATION) return next();
    
    if (tokenManager.validateToken(APP_TOKENS.AUTH_TOKEN, token)) {
        next(); // Conexi√≥n autorizada
    } else {
        next(new Error('Invalid token')); // Rechazada
    }
});
```

---

### üîë Sistema de Tokens

#### TokenManager (Singleton)
```typescript
// services/TokenManager/index.ts
```

**M√©todos:**
```typescript
// Generar token √∫nico (nanoid)
generateToken(key: string): string

// Validar token
validateToken(key: string, token: string): boolean

// Obtener token existente
getToken(key: string): string | Error

// Revocar token
revokeToken(key: string): void
```

**Uso:**
```typescript
// En servidor (main)
const tokenManager = TokenManager.getInstance();
const authToken = tokenManager.generateToken(APP_TOKENS.AUTH_TOKEN);

// En cliente (React)
const token = await window.electron.getAuthToken();
socket.auth = { token };
socket.connect();
```

---

## üìù Sistema de Logs

### Clase Log

**Ubicaci√≥n:** `src/app/src/utils/log.ts`

**Instanciaci√≥n:**
```typescript
const log = new Log('ServiceName', verbose);
// verbose = true ‚Üí logs en consola tambi√©n
// verbose = false ‚Üí solo archivo (si WRITE_LOG_TO_FILE=true)
```

### M√©todos Disponibles

```typescript
// Niveles de log
log.debug('Mensaje de debug', objeto);  // M√°s detallado
log.info('Informaci√≥n general', datos);  // Normal
log.warn('Advertencia', error);          // Atenci√≥n
log.error('Error cr√≠tico', exception);   // Cr√≠tico

// Utilidades
log.getLogDirectory();     // Ruta absoluta de logs/
log.getCurrentLogFile();   // Ruta del archivo actual
```

### Formato de Logs

```log
2025-10-24T10:30:45.123Z [LEVEL] [source] Message {optional: "data"}
‚îÇ                         ‚îÇ       ‚îÇ        ‚îÇ
‚îÇ                         ‚îÇ       ‚îÇ        ‚îî‚îÄ Mensaje y datos
‚îÇ                         ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Fuente (nombre del logger)
‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Nivel (DEBUG/INFO/WARN/ERROR)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Timestamp ISO 8601
```

### Gesti√≥n Autom√°tica de Archivos

- **1 archivo por d√≠a:** `24-10-2025.log`
- **M√°ximo 50 archivos** (m√°s antiguos se eliminan)
- **Creaci√≥n autom√°tica** del directorio `logs/`
- **Rotaci√≥n silenciosa** (no afecta performance)

### Ubicaciones por Entorno

| Entorno | Ubicaci√≥n |
|---------|-----------|
| **Desarrollo** | `./logs/` (ra√≠z del proyecto) |
| **Electron (producci√≥n)** | Junto al .exe (`AppFolder/logs/`) |
| **Headless (producci√≥n)** | `./logs/` (donde se ejecute) |

---

## üõ†Ô∏è Configuraci√≥n de TypeScript

El proyecto usa m√∫ltiples configuraciones de TypeScript para diferentes targets:

### tsconfig.json (Base)
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "paths": {
      "@common/*": ["./src/common/*"],
      "@src/*": ["./src/app/src/*"],
      "@utils/*": ["./src/app/src/utils/*"]
    }
  }
}
```

### tsconfig-electron.json
Para compilaci√≥n de Electron (main + preload)

### tsconfig-headless.json
Para compilaci√≥n headless (sin Electron)

### tsconfig-vite.json
Para la UI React con Vite

---

## üì¶ Scripts NPM Completos

### Desarrollo
```bash
# Solo UI (sin backend)
npm run dev:react

# Electron completo (UI + Backend)
npm run dev:electron

# Solo proceso Electron (requiere Vite corriendo)
npm run dev:electron:only

# Headless completo
npm run dev:headless

# Solo proceso headless (requiere Vite corriendo)
npm run dev:headless:only
```

### Build
```bash
# Build UI (Vite)
npm run build:vite

# Build Electron (esbuild)
npm run build:electron

# Build Headless (esbuild)
npm run build:headless
```

### Distribuci√≥n
```bash
# Crear ejecutables
npm run dist:win      # Windows (.exe)
npm run dist:mac      # macOS (.dmg, ARM64)
npm run dist:linux    # Linux (.AppImage)
npm run dist:headless # Headless (dist/headless/)
```

### Limpieza
```bash
npm run clean:dist      # Borra dist/
npm run clean:electron  # Borra dist-electron/
npm run clean:headless  # Borra dist/headless/
```

### Utilidades
```bash
npm run increment:version  # Incrementa versi√≥n patch
npm run transpile:electron # Limpia + build Electron
npm run transpile:headless # Limpia + build Headless
```

---

## üéØ Casos de Uso Recomendados

### ‚úÖ Usar Modo Electron Cuando:
- Necesitas una aplicaci√≥n de escritorio tradicional
- Requieres acceso completo al sistema de archivos
- Quieres men√∫s nativos, notificaciones, bandejas
- La aplicaci√≥n debe ejecutarse offline
- Necesitas empaquetado para distribuci√≥n (instaladores)

**Ejemplos:**
- Editores de c√≥digo
- Clientes de chat
- Herramientas de desarrollo
- Apps de productividad

---

### ‚úÖ Usar Modo Headless Cuando:
- Solo necesitas un servidor backend/API
- La UI ser√° un SPA accesible desde navegador
- Despliegue en servidores remotos (VPS, cloud)
- Necesitas menor consumo de recursos
- Arquitectura microservicios

**Ejemplos:**
- APIs REST
- Servidores de juegos
- Servicios de procesamiento
- Backends para apps m√≥viles

---

## üîí Configuraciones de Seguridad Recomendadas

### Desarrollo Local
```env
USE_AUTHENTICATION=false
LOCALHOST_ONLY=true
USE_CONTEXT_ISOLATION=false
PUBLIC_ENDPOINTS=[/public]
```

### Producci√≥n Electron
```env
USE_AUTHENTICATION=true
LOCALHOST_ONLY=true
USE_CONTEXT_ISOLATION=true
PUBLIC_ENDPOINTS=[/public]
```

### Producci√≥n Headless (Servidor Privado)
```env
USE_AUTHENTICATION=true
LOCALHOST_ONLY=true
USE_CONTEXT_ISOLATION=false  # No hay Electron
PUBLIC_ENDPOINTS=[/api/health,/docs]
```

### Producci√≥n Headless (Servidor P√∫blico)
```env
USE_AUTHENTICATION=true
LOCALHOST_ONLY=false  # ‚ö†Ô∏è Permite acceso externo
USE_CONTEXT_ISOLATION=false
PUBLIC_ENDPOINTS=[/api/v1,/docs]
```

---

## üöÄ Pr√≥ximos Pasos

### Para Empezar a Desarrollar:

1. **Clonar y configurar:**
```bash
git clone <repo>
cd Electron-Vite-TS
npm install
cp .env.example .env  # Configurar variables
```

2. **Desarrollo:**
```bash
# Opci√≥n 1: Todo en uno
npm run dev:electron

# Opci√≥n 2: Separado (dos terminales)
npm run dev:react        # Terminal 1
npm run dev:electron:only  # Terminal 2
```

3. **Personalizar:**
- Modificar `.env` seg√∫n necesidades
- Editar `src/ui/` para la interfaz
- Agregar l√≥gica en `src/app/src/services/`
- Implementar rutas en `src/app/src/services/Server/`

4. **Distribuir:**
```bash
# Electron
npm run dist:win  # o mac/linux

# Headless
npm run dist:headless
cd dist/headless
npm install --production
node main.js
```

---

## üìö Recursos Adicionales

### Documentaci√≥n de Dependencias:
- [Electron](https://www.electronjs.org/docs)
- [Vite](https://vitejs.dev/)
- [React](https://react.dev/)
- [Express](https://expressjs.com/)
- [Socket.IO](https://socket.io/docs/)
- [electron-builder](https://www.electron.build/)

### Herramientas de Desarrollo:
- [Electron DevTools](https://www.electronjs.org/docs/latest/tutorial/devtools-extension)
- [React DevTools](https://react.dev/learn/react-developer-tools)
- [Socket.IO Admin UI](https://socket.io/docs/v4/admin-ui/)

---

## üêõ Troubleshooting

### Problema: Puerto en uso
```bash
Error: listen EADDRINUSE: address already in use :::3000
```
**Soluci√≥n:** Cambiar `MAIN_SERVER_PORT` en `.env`

### Problema: Electron no abre ventana
**Verificar:**
1. `HEADLESS` no est√© en `true`
2. Logs en consola (`[electronProcess]`)
3. Permisos de ejecuci√≥n

### Problema: Socket.IO no conecta
**Verificar:**
1. `USE_AUTHENTICATION` y token v√°lido
2. `USE_CONTEXT_ISOLATION` y headers correctos
3. CORS configurado en `init` de Socket.IO
4. Puerto correcto en cliente

### Problema: Logs no se crean
**Verificar:**
1. `WRITE_LOG_TO_FILE=true`
2. Permisos de escritura en `logs/`
3. `WRITE_LOG_LEVEL` apropiado

---

## üìÑ Licencia

Este proyecto est√° bajo licencia MIT. Ver archivo `LICENSE` para m√°s detalles.

---

## üë• Contribuir

Para contribuir al proyecto:
1. Fork del repositorio
2. Crear rama feature (`git checkout -b feature/AmazingFeature`)
3. Commit cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abrir Pull Request

---

## üìû Soporte

- **Issues:** [GitHub Issues](https://github.com/usuario/repo/issues)
- **Email:** soporte@proyeccionesdigitales.com
- **Documentaci√≥n:** Este archivo y c√≥digo fuente

---

**√öltima actualizaci√≥n:** Octubre 2025  
**Versi√≥n del boilerplate:** 1.0.0  
**Autor:** Proyecciones Digitales
